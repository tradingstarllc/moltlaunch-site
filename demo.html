<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MoltLaunch Demo ‚Äî Live Verification Flow</title>
    <meta name="description" content="Watch MoltLaunch verify an AI agent in real-time: hardware identity, STARK proofs, Sybil detection, and on-chain scoring.">
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;700&family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="icon" type="image/png" sizes="192x192" href="/icons/icon-192.png">
    
    <style>
        :root {
            --bg: #0a0a0f;
            --bg-bar: #111118;
            --green: #14F195;
            --green-dim: #0d9e63;
            --purple: #9945FF;
            --blue: #00D4FF;
            --yellow: #fbbf24;
            --red: #ef4444;
            --text: #e0e0e0;
            --text-muted: #666;
            --comment: #6a737d;
            --json-key: #79c0ff;
            --json-string: #a5d6ff;
            --json-number: #f2cc60;
            --json-bool: #ff7b72;
            --json-null: #8b949e;
            --caption-bg: rgba(20, 241, 149, 0.08);
            --caption-border: rgba(20, 241, 149, 0.25);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        html, body { height: 100%; overflow: hidden; }
        body {
            font-family: 'JetBrains Mono', monospace;
            background: var(--bg);
            color: var(--text);
            display: flex;
            flex-direction: column;
        }

        /* ‚îÄ‚îÄ Top Bar ‚îÄ‚îÄ */
        .top-bar {
            background: var(--bg-bar);
            border-bottom: 1px solid #1e1e2a;
            padding: 12px 24px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-shrink: 0;
            z-index: 10;
        }
        .top-bar-left {
            display: flex;
            align-items: center;
            gap: 16px;
        }
        .top-bar-title {
            font-family: 'Inter', sans-serif;
            font-weight: 700;
            font-size: 1rem;
            color: #fff;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .top-bar-title .logo-icon {
            width: 28px;
            height: 28px;
            background: linear-gradient(135deg, var(--green), var(--purple));
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
        }
        .step-counter {
            font-family: 'Inter', sans-serif;
            font-size: 0.8rem;
            color: var(--text-muted);
            font-weight: 400;
        }
        .step-counter .current-step { color: var(--green); font-weight: 600; }

        /* Step dots */
        .step-dots {
            display: flex;
            gap: 8px;
            align-items: center;
        }
        .step-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #2a2a3a;
            transition: all 0.3s ease;
        }
        .step-dot.active {
            background: var(--green);
            box-shadow: 0 0 8px rgba(20, 241, 149, 0.5);
        }
        .step-dot.done {
            background: var(--green-dim);
        }

        .top-bar-right {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .top-btn {
            font-family: 'Inter', sans-serif;
            font-size: 0.75rem;
            padding: 6px 14px;
            border-radius: 6px;
            border: 1px solid #2a2a3a;
            background: transparent;
            color: var(--text-muted);
            cursor: pointer;
            transition: all 0.15s;
        }
        .top-btn:hover {
            color: #fff;
            border-color: #444;
            background: rgba(255,255,255,0.05);
        }

        /* ‚îÄ‚îÄ Progress Bar ‚îÄ‚îÄ */
        .progress-bar {
            height: 3px;
            background: #1a1a24;
            flex-shrink: 0;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--green), var(--blue));
            width: 0%;
            transition: width 0.5s ease;
        }

        /* ‚îÄ‚îÄ Terminal ‚îÄ‚îÄ */
        .terminal {
            flex: 1;
            overflow-y: auto;
            padding: 24px 32px;
            scroll-behavior: smooth;
        }
        .terminal::-webkit-scrollbar { width: 8px; }
        .terminal::-webkit-scrollbar-track { background: transparent; }
        .terminal::-webkit-scrollbar-thumb { background: #2a2a3a; border-radius: 4px; }
        .terminal::-webkit-scrollbar-thumb:hover { background: #3a3a4a; }

        .terminal-content {
            max-width: 900px;
            margin: 0 auto;
        }

        /* ‚îÄ‚îÄ Lines ‚îÄ‚îÄ */
        .line {
            margin-bottom: 2px;
            white-space: pre-wrap;
            word-break: break-all;
            line-height: 1.6;
            font-size: 0.85rem;
        }
        .line .prompt {
            color: var(--green);
            user-select: none;
        }
        .line .command {
            color: #e0e0e0;
        }
        .line.comment .command {
            color: var(--comment);
        }

        /* ‚îÄ‚îÄ JSON Response ‚îÄ‚îÄ */
        .response-block {
            background: #0d0d14;
            border: 1px solid #1e1e2a;
            border-radius: 8px;
            padding: 16px 20px;
            margin: 8px 0 4px 0;
            font-size: 0.8rem;
            line-height: 1.7;
            opacity: 0;
            transform: translateY(4px);
            transition: opacity 0.3s ease, transform 0.3s ease;
            overflow-x: auto;
        }
        .response-block.visible {
            opacity: 1;
            transform: translateY(0);
        }
        .json-key { color: var(--json-key); }
        .json-string { color: var(--json-string); }
        .json-number { color: var(--json-number); }
        .json-bool { color: var(--json-bool); }
        .json-null { color: var(--json-null); }
        .json-brace { color: #8b949e; }

        /* ‚îÄ‚îÄ Caption ‚îÄ‚îÄ */
        .caption {
            background: var(--caption-bg);
            border: 1px solid var(--caption-border);
            border-radius: 8px;
            padding: 10px 16px;
            margin: 8px 0 20px 0;
            font-family: 'Inter', sans-serif;
            font-size: 0.82rem;
            color: var(--green);
            line-height: 1.5;
            opacity: 0;
            transform: translateY(4px);
            transition: opacity 0.3s ease, transform 0.3s ease;
        }
        .caption.visible {
            opacity: 1;
            transform: translateY(0);
        }

        /* ‚îÄ‚îÄ Cursor ‚îÄ‚îÄ */
        .cursor {
            display: inline-block;
            width: 8px;
            height: 16px;
            background: var(--green);
            vertical-align: text-bottom;
            animation: blink 1s step-end infinite;
            margin-left: 1px;
        }
        @keyframes blink {
            50% { opacity: 0; }
        }

        /* ‚îÄ‚îÄ End Screen ‚îÄ‚îÄ */
        .end-screen {
            display: none;
            text-align: center;
            padding: 40px 20px;
            margin-top: 20px;
        }
        .end-screen.visible { display: block; }
        .end-screen h2 {
            font-family: 'Inter', sans-serif;
            font-size: 1.3rem;
            font-weight: 700;
            color: #fff;
            margin-bottom: 8px;
        }
        .end-screen p {
            font-family: 'Inter', sans-serif;
            font-size: 0.85rem;
            color: var(--text-muted);
            margin-bottom: 24px;
        }
        .end-buttons {
            display: flex;
            gap: 12px;
            justify-content: center;
            flex-wrap: wrap;
        }
        .end-btn {
            font-family: 'Inter', sans-serif;
            font-size: 0.85rem;
            font-weight: 600;
            padding: 12px 28px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            text-decoration: none;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        .end-btn-primary {
            background: var(--green);
            color: #000;
        }
        .end-btn-primary:hover {
            background: #1aff9e;
            transform: translateY(-1px);
        }
        .end-btn-secondary {
            background: transparent;
            border: 1px solid #2a2a3a;
            color: var(--text);
        }
        .end-btn-secondary:hover {
            border-color: #444;
            background: rgba(255,255,255,0.05);
        }
        .end-btn-replay {
            background: transparent;
            border: 1px solid var(--green);
            color: var(--green);
        }
        .end-btn-replay:hover {
            background: rgba(20, 241, 149, 0.1);
        }

        /* ‚îÄ‚îÄ Back Link ‚îÄ‚îÄ */
        .back-link {
            position: fixed;
            bottom: 20px;
            left: 24px;
            font-family: 'Inter', sans-serif;
            font-size: 0.75rem;
            color: var(--text-muted);
            text-decoration: none;
            opacity: 0.6;
            transition: opacity 0.2s;
            z-index: 10;
        }
        .back-link:hover { opacity: 1; }

        /* ‚îÄ‚îÄ Responsive ‚îÄ‚îÄ */
        @media (max-width: 768px) {
            .terminal { padding: 16px; }
            .line { font-size: 0.72rem; }
            .response-block { font-size: 0.68rem; padding: 12px; }
            .caption { font-size: 0.75rem; }
            .top-bar { padding: 10px 16px; }
            .top-bar-title { font-size: 0.85rem; }
            .step-dots { gap: 6px; }
            .step-dot { width: 8px; height: 8px; }
        }
        @media (max-width: 480px) {
            .terminal { padding: 12px 8px; }
            .line { font-size: 0.65rem; }
            .response-block { font-size: 0.6rem; padding: 8px; }
            .step-counter { display: none; }
        }
    </style>
</head>
<body>

    <!-- Top Bar -->
    <div class="top-bar">
        <div class="top-bar-left">
            <div class="top-bar-title">
                <span class="logo-icon">ü¶é</span>
                MoltLaunch Demo
            </div>
            <div class="step-dots" id="stepDots">
                <div class="step-dot" data-step="0"></div>
                <div class="step-dot" data-step="1"></div>
                <div class="step-dot" data-step="2"></div>
                <div class="step-dot" data-step="3"></div>
                <div class="step-dot" data-step="4"></div>
                <div class="step-dot" data-step="5"></div>
                <div class="step-dot" data-step="6"></div>
            </div>
            <span class="step-counter" id="stepCounter">Step <span class="current-step">1</span> of 7</span>
        </div>
        <div class="top-bar-right">
            <button class="top-btn" id="skipBtn" onclick="skipToEnd()">Skip ‚è≠</button>
        </div>
    </div>

    <!-- Progress Bar -->
    <div class="progress-bar">
        <div class="progress-fill" id="progressFill"></div>
    </div>

    <!-- Terminal -->
    <div class="terminal" id="terminal">
        <div class="terminal-content" id="terminalContent">
        </div>
    </div>

    <!-- Back Link -->
    <a href="/index.html" class="back-link">‚Üê Back to MoltLaunch</a>

    <script>
    // ‚îÄ‚îÄ‚îÄ Configuration ‚îÄ‚îÄ‚îÄ
    const TYPE_SPEED = 25;        // ms per character
    const PAUSE_AFTER_CMD = 400;  // ms pause after command typed
    const PAUSE_AFTER_RESP = 2200; // ms pause after response shown
    const PAUSE_BETWEEN_LINES = 150; // ms between multi-line commands
    const START_DELAY = 1000;     // ms before demo starts

    // ‚îÄ‚îÄ‚îÄ Demo Steps ‚îÄ‚îÄ‚îÄ
    const steps = [
        // Step 1: Intro
        {
            stepIndex: 0,
            lines: [
                { type: 'comment', text: '# MoltLaunch ‚Äî Agent Verification Protocol on Solana' },
                { type: 'comment', text: '# Making Sybil attacks cost $500/month instead of $0' },
                { type: 'command', text: 'echo "Let\'s verify an AI agent..."', output: 'Let\'s verify an AI agent...' },
            ]
        },
        // Step 2: Register Hardware Identity
        {
            stepIndex: 1,
            lines: [
                {
                    type: 'command',
                    text: 'curl -X POST https://web-production-419d9.up.railway.app/api/identity/register \\\n  -H "Content-Type: application/json" \\\n  -d \'{"agentId": "demo-agent", "identityHash": "7f04b937d885...", "includesHardware": true}\'',
                    response: {
                        "success": true,
                        "registrationId": "reg_abc123",
                        "identityHash": "7f04b937d885...",
                        "trustLevel": 3,
                        "trustDescription": "Hardware-anchored (unique hardware + code)",
                        "sybilWarning": null
                    },
                    caption: '‚úÖ Agent registered with hardware fingerprint. Trust Level 3 = $100/mo per Sybil identity.'
                }
            ]
        },
        // Step 3: Deep Verification
        {
            stepIndex: 2,
            lines: [
                {
                    type: 'command',
                    text: 'curl -X POST https://web-production-419d9.up.railway.app/api/verify/deep \\\n  -H "Content-Type: application/json" \\\n  -d \'{"agentId": "demo-agent", "capabilities": ["trading", "analysis"], "codeUrl": "https://github.com/tradingstarllc/moltlaunch"}\'',
                    response: {
                        "verified": true,
                        "score": 78,
                        "tier": "good",
                        "onChainAI": {
                            "enabled": true,
                            "executedOnChain": true,
                            "vm": "FHcy35f4NGZK9b6j5TGMYstfB6PXEtmNbMLvjfR1y2Li"
                        },
                        "attestation": {
                            "hash": "a07a7088c1a1787e...",
                            "expiresAt": "2026-03-12"
                        }
                    },
                    caption: '‚úÖ Score 78/100 ‚Äî \'Good\' tier. On-chain AI scored via Cauldron RISC-V VM.'
                }
            ]
        },
        // Step 4: STARK Proof
        {
            stepIndex: 3,
            lines: [
                {
                    type: 'command',
                    text: 'curl -X POST https://web-production-419d9.up.railway.app/api/stark/generate/demo-agent \\\n  -H "Content-Type: application/json" \\\n  -d \'{"threshold": 60}\'',
                    response: {
                        "valid": true,
                        "claim": "Score >= 60",
                        "proof": {
                            "commitment": "a07a7088...",
                            "proofHash": "verified"
                        },
                        "privacyNote": "Score is NOT revealed ‚Äî only that it passed 60"
                    },
                    caption: '‚úÖ STARK proof generated. Verifier knows: passed 60. Doesn\'t know: scored 78.'
                }
            ]
        },
        // Step 5: Sybil Check
        {
            stepIndex: 4,
            lines: [
                {
                    type: 'command',
                    text: 'curl -X POST https://web-production-419d9.up.railway.app/api/identity/table-check \\\n  -H "Content-Type: application/json" \\\n  -d \'{"agentIds": ["demo-agent", "trading-bot", "poker-bot", "suspicious-clone"]}\'',
                    response: {
                        "totalAgents": 4,
                        "identifiedAgents": 3,
                        "sybilClusters": [],
                        "flaggedAgents": [],
                        "safe": true,
                        "recommendation": "No Sybil clusters detected ‚Äî safe to proceed"
                    },
                    caption: '‚úÖ Table check: no duplicate hardware fingerprints. Safe to seat all 4 agents.'
                }
            ]
        },
        // Step 6: Unified SAP Validation
        {
            stepIndex: 5,
            lines: [
                {
                    type: 'command',
                    text: 'curl -X POST https://web-production-419d9.up.railway.app/api/validate \\\n  -H "Content-Type: application/json" \\\n  -d \'{"agentId": "demo-agent", "validationType": ["identity","scoring","sybil","proof"], "trustRequired": 3}\'',
                    response: {
                        "passed": true,
                        "identity": { "trustLevel": 3, "meetsRequired": true },
                        "scoring": { "score": 78, "passed": true },
                        "sybil": { "status": "clean", "risk": "LOW" },
                        "proof": { "valid": true, "claim": "score >= 60" },
                        "erc8004Compatible": { "response": 78, "tag": "moltlaunch-sap-v1" }
                    },
                    caption: '‚úÖ Full SAP validation: identity verified, scored, Sybil-clean, STARK proof valid, ERC-8004 compatible.'
                }
            ]
        },
        // Step 7: Summary
        {
            stepIndex: 6,
            lines: [
                { type: 'command', text: 'echo "Demo complete."', output: 'Demo complete.' },
                { type: 'blank' },
                { type: 'command', text: 'echo "What we just did:"', output: 'What we just did:' },
                { type: 'command', text: 'echo "  1. Registered hardware-anchored identity (Trust Level 3)"', output: '  1. Registered hardware-anchored identity (Trust Level 3)' },
                { type: 'command', text: 'echo "  2. Verified agent with on-chain AI scoring (78/100)"', output: '  2. Verified agent with on-chain AI scoring (78/100)' },
                { type: 'command', text: 'echo "  3. Generated STARK proof (privacy-preserving)"', output: '  3. Generated STARK proof (privacy-preserving)' },
                { type: 'command', text: 'echo "  4. Checked table for Sybil clones (clean)"', output: '  4. Checked table for Sybil clones (clean)' },
                { type: 'command', text: 'echo "  5. Ran unified SAP validation (all passed)"', output: '  5. Ran unified SAP validation (all passed)' },
                { type: 'blank' },
                { type: 'command', text: 'echo "Cost per verification: $0.01-0.10 via x402"', output: 'Cost per verification: $0.01-0.10 via x402' },
                { type: 'command', text: 'echo "Sybil cost: $100-500/month per fake identity"', output: 'Sybil cost: $100-500/month per fake identity' },
                { type: 'command', text: 'echo "Only possible on Solana (DePIN + 400ms blocks)"', output: 'Only possible on Solana (DePIN + 400ms blocks)' },
                { type: 'blank' },
                { type: 'command', text: 'echo "Try it: npm install @moltlaunch/sdk"', output: 'Try it: npm install @moltlaunch/sdk' },
            ]
        }
    ];

    // ‚îÄ‚îÄ‚îÄ State ‚îÄ‚îÄ‚îÄ
    let currentStep = 0;
    let isRunning = false;
    let abortController = null;
    const terminalContent = document.getElementById('terminalContent');
    const terminal = document.getElementById('terminal');

    // ‚îÄ‚îÄ‚îÄ Utilities ‚îÄ‚îÄ‚îÄ
    function delay(ms) {
        return new Promise(resolve => {
            const id = setTimeout(resolve, ms);
            if (abortController) {
                abortController.signal.addEventListener('abort', () => {
                    clearTimeout(id);
                    resolve();
                });
            }
        });
    }

    function scrollToBottom() {
        terminal.scrollTop = terminal.scrollHeight;
    }

    function updateProgress(step, total) {
        const pct = ((step + 1) / total) * 100;
        document.getElementById('progressFill').style.width = pct + '%';
        document.getElementById('stepCounter').innerHTML = 
            `Step <span class="current-step">${step + 1}</span> of ${total}`;
        
        document.querySelectorAll('.step-dot').forEach((dot, i) => {
            dot.classList.remove('active', 'done');
            if (i === step) dot.classList.add('active');
            else if (i < step) dot.classList.add('done');
        });
    }

    // ‚îÄ‚îÄ‚îÄ JSON Syntax Highlighting ‚îÄ‚îÄ‚îÄ
    function syntaxHighlight(json) {
        return json.replace(/("(\\u[\da-fA-F]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)/g, function (match) {
            let cls = 'json-number';
            if (/^"/.test(match)) {
                if (/:$/.test(match)) {
                    cls = 'json-key';
                    // Remove the colon from match, we'll add it back
                    return '<span class="' + cls + '">' + match.slice(0, -1) + '</span>:';
                } else {
                    cls = 'json-string';
                }
            } else if (/true|false/.test(match)) {
                cls = 'json-bool';
            } else if (/null/.test(match)) {
                cls = 'json-null';
            }
            return '<span class="' + cls + '">' + match + '</span>';
        }).replace(/([{}[\]])/g, '<span class="json-brace">$1</span>');
    }

    // ‚îÄ‚îÄ‚îÄ Create Line Element ‚îÄ‚îÄ‚îÄ
    function createLine(type) {
        const div = document.createElement('div');
        div.className = 'line' + (type === 'comment' ? ' comment' : '');
        return div;
    }

    // ‚îÄ‚îÄ‚îÄ Type Text Into Element ‚îÄ‚îÄ‚îÄ
    async function typeText(element, text, speed = TYPE_SPEED) {
        if (abortController && abortController.signal.aborted) return;
        
        const prompt = document.createElement('span');
        prompt.className = 'prompt';
        prompt.textContent = '$ ';
        element.appendChild(prompt);

        const cmd = document.createElement('span');
        cmd.className = 'command';
        element.appendChild(cmd);

        const cursor = document.createElement('span');
        cursor.className = 'cursor';
        element.appendChild(cursor);

        for (let i = 0; i < text.length; i++) {
            if (abortController && abortController.signal.aborted) {
                cmd.textContent = text;
                break;
            }
            cmd.textContent += text[i];
            scrollToBottom();
            await delay(speed);
        }

        cursor.remove();
    }

    // ‚îÄ‚îÄ‚îÄ Show Plain Output ‚îÄ‚îÄ‚îÄ
    function showOutput(text) {
        const div = document.createElement('div');
        div.className = 'line';
        div.style.color = '#e0e0e0';
        div.textContent = text;
        terminalContent.appendChild(div);
        scrollToBottom();
    }

    // ‚îÄ‚îÄ‚îÄ Show JSON Response ‚îÄ‚îÄ‚îÄ
    function showResponse(json) {
        const block = document.createElement('pre');
        block.className = 'response-block';
        const formatted = JSON.stringify(json, null, 2);
        block.innerHTML = syntaxHighlight(formatted);
        terminalContent.appendChild(block);
        scrollToBottom();
        // Trigger animation
        requestAnimationFrame(() => {
            block.classList.add('visible');
            scrollToBottom();
        });
    }

    // ‚îÄ‚îÄ‚îÄ Show Caption ‚îÄ‚îÄ‚îÄ
    function showCaption(text) {
        const div = document.createElement('div');
        div.className = 'caption';
        div.textContent = text;
        terminalContent.appendChild(div);
        scrollToBottom();
        requestAnimationFrame(() => {
            div.classList.add('visible');
            scrollToBottom();
        });
    }

    // ‚îÄ‚îÄ‚îÄ Show End Screen ‚îÄ‚îÄ‚îÄ
    function showEndScreen() {
        const div = document.createElement('div');
        div.className = 'end-screen visible';
        div.innerHTML = `
            <h2>‚úÖ Verification Complete</h2>
            <p>You just watched MoltLaunch verify an AI agent end-to-end on Solana.</p>
            <div class="end-buttons">
                <button class="end-btn end-btn-replay" onclick="replayDemo()">‚Üª Replay Demo</button>
                <a href="/pitch.html" class="end-btn end-btn-primary">View Pitch Deck ‚Üí</a>
                <a href="/docs.html#api" class="end-btn end-btn-secondary">Try the API ‚Üí</a>
            </div>
        `;
        terminalContent.appendChild(div);
        scrollToBottom();
    }

    // ‚îÄ‚îÄ‚îÄ Run Demo ‚îÄ‚îÄ‚îÄ
    async function runDemo() {
        if (isRunning) return;
        isRunning = true;
        abortController = new AbortController();
        
        terminalContent.innerHTML = '';
        currentStep = 0;

        for (let s = 0; s < steps.length; s++) {
            if (abortController.signal.aborted) break;
            
            currentStep = s;
            updateProgress(s, steps.length);

            const step = steps[s];

            for (let l = 0; l < step.lines.length; l++) {
                if (abortController.signal.aborted) break;

                const line = step.lines[l];

                if (line.type === 'blank') {
                    const blank = document.createElement('div');
                    blank.className = 'line';
                    blank.innerHTML = '&nbsp;';
                    terminalContent.appendChild(blank);
                    scrollToBottom();
                    await delay(PAUSE_BETWEEN_LINES);
                    continue;
                }

                if (line.type === 'comment') {
                    const el = createLine('comment');
                    terminalContent.appendChild(el);
                    await typeText(el, line.text, TYPE_SPEED);
                    await delay(PAUSE_BETWEEN_LINES);
                    continue;
                }

                if (line.type === 'command') {
                    const el = createLine('command');
                    terminalContent.appendChild(el);
                    await typeText(el, line.text, TYPE_SPEED);
                    await delay(PAUSE_AFTER_CMD);

                    // Show plain output if any
                    if (line.output) {
                        showOutput(line.output);
                    }

                    // Show JSON response if any
                    if (line.response) {
                        showResponse(line.response);
                        await delay(200);
                    }

                    // Show caption if any
                    if (line.caption) {
                        showCaption(line.caption);
                    }

                    // Pause between lines within a step
                    if (l < step.lines.length - 1) {
                        await delay(PAUSE_BETWEEN_LINES);
                    }
                }
            }

            // Pause between steps (longer for steps with responses)
            if (s < steps.length - 1) {
                await delay(step.lines.some(l => l.response) ? PAUSE_AFTER_RESP : 1200);
            }
        }

        // Show blinking cursor at end
        const finalLine = createLine('command');
        const prompt = document.createElement('span');
        prompt.className = 'prompt';
        prompt.textContent = '$ ';
        finalLine.appendChild(prompt);
        const cursor = document.createElement('span');
        cursor.className = 'cursor';
        finalLine.appendChild(cursor);
        terminalContent.appendChild(finalLine);
        scrollToBottom();

        await delay(800);

        // Remove cursor and show end screen
        cursor.remove();
        showEndScreen();

        isRunning = false;
        document.getElementById('skipBtn').textContent = 'Replay ‚Üª';
        document.getElementById('skipBtn').onclick = replayDemo;
    }

    // ‚îÄ‚îÄ‚îÄ Skip to End ‚îÄ‚îÄ‚îÄ
    function skipToEnd() {
        if (abortController) {
            abortController.abort();
        }

        // Render everything instantly
        terminalContent.innerHTML = '';

        for (const step of steps) {
            for (const line of step.lines) {
                if (line.type === 'blank') {
                    const blank = document.createElement('div');
                    blank.className = 'line';
                    blank.innerHTML = '&nbsp;';
                    terminalContent.appendChild(blank);
                    continue;
                }

                const el = createLine(line.type === 'comment' ? 'comment' : 'command');
                const prompt = document.createElement('span');
                prompt.className = 'prompt';
                prompt.textContent = '$ ';
                el.appendChild(prompt);
                const cmd = document.createElement('span');
                cmd.className = 'command';
                cmd.textContent = line.text || '';
                el.appendChild(cmd);
                terminalContent.appendChild(el);

                if (line.output) {
                    showOutput(line.output);
                }

                if (line.response) {
                    const block = document.createElement('pre');
                    block.className = 'response-block visible';
                    block.innerHTML = syntaxHighlight(JSON.stringify(line.response, null, 2));
                    terminalContent.appendChild(block);
                }

                if (line.caption) {
                    const cap = document.createElement('div');
                    cap.className = 'caption visible';
                    cap.textContent = line.caption;
                    terminalContent.appendChild(cap);
                }
            }
        }

        showEndScreen();
        updateProgress(steps.length - 1, steps.length);
        scrollToBottom();

        isRunning = false;
        document.getElementById('skipBtn').textContent = 'Replay ‚Üª';
        document.getElementById('skipBtn').onclick = replayDemo;
    }

    // ‚îÄ‚îÄ‚îÄ Replay ‚îÄ‚îÄ‚îÄ
    function replayDemo() {
        if (abortController) abortController.abort();
        isRunning = false;
        document.getElementById('skipBtn').textContent = 'Skip ‚è≠';
        document.getElementById('skipBtn').onclick = skipToEnd;
        setTimeout(() => runDemo(), 200);
    }

    // ‚îÄ‚îÄ‚îÄ Keyboard Shortcuts ‚îÄ‚îÄ‚îÄ
    document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' || e.key === 's') {
            skipToEnd();
        }
        if (e.key === 'r') {
            replayDemo();
        }
    });

    // ‚îÄ‚îÄ‚îÄ Start ‚îÄ‚îÄ‚îÄ
    setTimeout(() => runDemo(), START_DELAY);
    </script>
</body>
</html>
